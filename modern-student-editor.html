<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Modern Student Editor - ARNOMA</title>
    <!--
        ========================================
        ARNOMA - MODERN STUDENT EDITOR
        ========================================

        HOW TO INTEGRATE INTO PRODUCTION (index.html):

        1. Copy the modal HTML (lines ~592-732) into your index.html
           - Place it near other modals (after studentManagerModal)
           - Keep the ID: studentEditorModal
           - Keep the z-index: 20000 to match other modals

        2. Copy the CSS (lines ~13-549) into your <style> section
           - Or add as inline styles to the modal

        3. Copy the JavaScript functions into your <script> section:
           - openStudentEditor(studentData)
           - closeEditor()
           - closeEditorOnOutsideClick(event)
           - saveStudent()
           - deleteStudent()
           - selectStatus()
           - toggleVisibility()
           - updateAvatar()

        4. Call from your student cards:
           onclick="openStudentEditor({
               id: student.id,
               name: student.name,
               group_name: student.group_name,
               email: student.email,
               phone: student.phone,
               price_per_class: student.price_per_class,
               balance: student.balance,
               status: student.status,
               show_in_grid: student.show_in_grid,
               notes: student.notes
           })"

        5. Uncomment the Supabase integration code in:
           - saveStudent() - Update student record
           - deleteStudent() - Delete student record

        6. Remove the test button (lines ~558-583)

        ========================================
    -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
        --dark-bg: #0f0f23;
        --card-bg: rgba(255, 255, 255, 0.05);
        --card-border: rgba(255, 255, 255, 0.1);
        --text-primary: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.7);
        --shadow-glow: 0 8px 32px 0 rgba(102, 126, 234, 0.37);
        --input-bg: rgba(255, 255, 255, 0.03);
        --input-border: rgba(255, 255, 255, 0.15);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: var(--dark-bg);
        min-height: 100vh;
        padding: 40px 20px;
        overflow-x: hidden;
        position: relative;
      }

      /* Animated background gradient */
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 40% 80%, rgba(79, 172, 254, 0.1) 0%, transparent 50%);
        animation: gradientShift 20s ease infinite;
        z-index: -1;
      }

      @keyframes gradientShift {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.8;
          transform: scale(1.1);
        }
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      /* Modal Overlay */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 20000;
        transition: opacity 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .modal-overlay.show {
        animation: fadeIn 0.3s ease;
      }

      /* Student Editor Modal */
      .student-editor {
        background: var(--card-bg);
        backdrop-filter: blur(30px);
        -webkit-backdrop-filter: blur(30px);
        border: 1px solid var(--card-border);
        border-radius: 24px;
        max-width: 800px;
        width: 95%;
        max-height: 90vh;
        overflow: hidden;
        box-shadow:
          var(--shadow-glow),
          0 20px 60px rgba(0, 0, 0, 0.5);
        position: relative;
        animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .student-editor::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary-gradient);
      }

      /* Header */
      .editor-header {
        padding: 24px 28px;
        border-bottom: 1px solid var(--card-border);
        display: flex;
        gap: 24px;
        align-items: stretch;
        background: rgba(8, 13, 40, 0.6);
        position: relative;
        overflow: hidden;
      }

      .editor-header::after {
        content: '';
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top right, rgba(118, 75, 162, 0.25), transparent 45%);
        pointer-events: none;
      }

      .header-identity {
        display: flex;
        align-items: center;
        gap: 18px;
        flex: 1;
        position: relative;
        z-index: 1;
      }

      .avatar-orbit {
        position: relative;
        width: 64px;
        height: 64px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .avatar-orbit::after {
        content: '';
        position: absolute;
        inset: -6px;
        border-radius: 24px;
        border: 1px solid rgba(102, 126, 234, 0.4);
        filter: blur(1px);
      }

      .student-avatar-large {
        width: 52px;
        height: 52px;
        border-radius: 16px;
        background: var(--primary-gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        font-weight: 700;
        color: white;
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.45);
      }

      .identity-details {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .identity-label {
        font-size: 0.72rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.6);
      }

      .identity-name-row {
        display: flex;
        align-items: baseline;
        gap: 12px;
        flex-wrap: wrap;
      }

      .identity-name-row h2 {
        font-size: 1.5rem;
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0;
      }

      .identity-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .meta-chip {
        padding: 6px 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        font-size: 0.8rem;
        color: var(--text-secondary);
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(10px);
      }

      .meta-chip.gradient {
        background: rgba(102, 126, 234, 0.35);
        color: #f0f7ff;
        border-color: transparent;
        box-shadow: 0 4px 16px rgba(102, 126, 234, 0.45);
      }

      .meta-chip.subtle {
        color: rgba(255, 255, 255, 0.5);
        border-style: dashed;
      }

      .meta-chip.chip-off {
        background: rgba(127, 29, 29, 0.7);
        border-color: rgba(248, 113, 113, 0.5);
        color: #fee2e2;
      }

      .header-actions {
        display: flex;
        align-items: stretch;
        gap: 16px;
        flex-wrap: wrap;
        position: relative;
        z-index: 1;
      }

      .status-block,
      .visibility-block {
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 18px;
        padding: 14px 18px;
        background: rgba(13, 17, 43, 0.7);
        display: flex;
        flex-direction: column;
        gap: 8px;
        min-width: 150px;
      }

      .status-label {
        font-size: 0.75rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.5);
      }

      .status-note {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
      }

      .visibility-block {
        cursor: pointer;
        align-items: flex-start;
      }

      .visibility-block .toggle-switch {
        transform: scale(0.9);
      }

      .visibility-hint {
        font-size: 0.78rem;
        color: rgba(255, 255, 255, 0.7);
      }

      @media (max-width: 720px) {
        .editor-header {
          flex-direction: column;
          align-items: stretch;
        }

        .header-actions {
          width: 100%;
        }

        .status-block,
        .visibility-block {
          flex: 1;
        }

        .header-actions .close-btn {
          margin-left: auto;
        }
      }

      .close-btn {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        border: 1px solid var(--card-border);
        background: var(--card-bg);
        color: var(--text-primary);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        transition: all 0.3s ease;
      }

      .close-btn:hover {
        background: var(--secondary-gradient);
        border-color: transparent;
        transform: rotate(90deg);
      }

      /* Body */
      .editor-body {
        padding: 20px 24px;
        max-height: calc(90vh - 200px);
        overflow-y: auto;
      }

      .editor-body::-webkit-scrollbar {
        width: 8px;
      }

      .editor-body::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
      }

      .editor-body::-webkit-scrollbar-thumb {
        background: var(--primary-gradient);
        border-radius: 10px;
      }

      /* Form Grid */
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 12px;
      }

      .form-grid.full-width {
        grid-template-columns: 1fr;
      }

      /* Form Group */
      .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .form-label {
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .form-label .icon {
        font-size: 0.9rem;
      }

      .required {
        color: #ef4444;
      }

      /* Input Styles */
      .form-input,
      .form-select,
      .form-textarea {
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        border-radius: 10px;
        padding: 10px 14px;
        color: var(--text-primary);
        font-size: 0.9rem;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: rgba(102, 126, 234, 0.6);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-input::placeholder {
        color: rgba(255, 255, 255, 0.3);
      }

      .form-textarea {
        resize: vertical;
        min-height: 70px;
      }

      /* Toggle Switch */
      .toggle-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        border-radius: 10px;
        padding: 10px 14px;
        transition: all 0.3s ease;
      }

      .toggle-container:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .toggle-label {
        font-size: 0.95rem;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .toggle-switch {
        position: relative;
        width: 50px;
        height: 26px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 13px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .toggle-switch.active {
        background: var(--accent-gradient);
      }

      .toggle-slider {
        position: absolute;
        top: 3px;
        left: 3px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .toggle-switch.active .toggle-slider {
        transform: translateX(24px);
      }

      /* Status Pills */
      .status-pills,
      .group-pills {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .group-pills {
        align-items: flex-end;
      }

      .status-pill,
      .group-pill {
        flex: 1;
        min-width: 90px;
        padding: 8px 12px;
        border-radius: 10px;
        border: 2px solid var(--input-border);
        background: var(--input-bg);
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 0.85rem;
        position: relative;
        overflow: hidden;
      }

      /* Group Pills - Round Shape */
      .group-pill {
        flex: 0;
        min-width: 50px;
        width: 50px;
        height: 50px;
        padding: 0;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 700;
      }

      /* Align ‚öôÔ∏è custom price pill with Unpaid box baseline */
      .group-pill[data-price='custom'] {
        align-self: flex-end;
        margin-top: auto;
        margin-bottom: 4px;
      }

      .status-pill::before,
      .group-pill::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        transition: left 0.3s ease;
        opacity: 0.2;
      }

      .status-pill:hover,
      .group-pill:hover {
        transform: translateY(-2px);
      }

      .status-pill.active::before,
      .group-pill.active::before {
        left: 0;
      }

      .status-pill.active,
      .group-pill.active {
        border-color: transparent;
        color: white;
      }

      .status-pill.status-active::before {
        background: var(--success-gradient);
      }

      .status-pill.status-active.active {
        background: var(--success-gradient);
      }

      .status-pill.status-paused::before {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }

      .status-pill.status-paused.active {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      }

      .status-pill.status-graduated::before {
        background: var(--accent-gradient);
      }

      .status-pill.status-graduated.active {
        background: var(--accent-gradient);
      }

      /* Group Pills */
      .group-pill::before {
        background: var(--primary-gradient);
      }

      .group-pill.active {
        background: var(--primary-gradient);
      }

      /* Status Pill Single (like production) */
      .status-pill-single {
        padding: 6px 16px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-transform: uppercase;
        border: 2px solid;
        user-select: none;
        display: inline-block;
      }

      .status-active {
        background: rgba(76, 175, 80, 0.25);
        border-color: #4caf50;
        color: #5eff6c;
        text-shadow:
          0 0 10px rgba(94, 255, 108, 0.5),
          0 0 20px rgba(94, 255, 108, 0.32);
        box-shadow:
          0 0 15px rgba(76, 175, 80, 0.38),
          0 0 30px rgba(76, 175, 80, 0.25),
          0 0 45px rgba(76, 175, 80, 0.13),
          inset 0 0 10px rgba(94, 255, 108, 0.13);
      }

      .status-active:hover {
        background: rgba(76, 175, 80, 0.35);
        border-color: rgba(76, 175, 80, 0.6);
        transform: scale(1.05);
      }

      .status-paused {
        background: rgba(251, 191, 36, 0.15);
        border-color: rgba(251, 191, 36, 0.4);
        color: #fbbf24;
      }

      .status-paused:hover {
        background: rgba(251, 191, 36, 0.25);
        border-color: rgba(251, 191, 36, 0.6);
        transform: scale(1.05);
      }

      .status-graduated {
        background: rgba(167, 139, 250, 0.15);
        border-color: rgba(167, 139, 250, 0.4);
        color: #a78bfa;
      }

      .status-graduated:hover {
        background: rgba(167, 139, 250, 0.25);
        border-color: rgba(167, 139, 250, 0.6);
        transform: scale(1.05);
      }

      /* Section Divider */
      .section-divider {
        margin: 20px 0;
        border: none;
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--card-border), transparent);
      }

      .section-title {
        font-size: 1rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-title::before {
        content: '';
        width: 3px;
        height: 18px;
        background: var(--primary-gradient);
        border-radius: 2px;
      }

      /* Footer Actions */
      .editor-footer {
        padding: 16px 24px;
        border-top: 1px solid var(--card-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0, 0, 0, 0.2);
        gap: 12px;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 10px;
        border: 1px solid var(--card-border);
        background: var(--card-bg);
        color: var(--text-primary);
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        transition: left 0.4s ease;
        z-index: -1;
      }

      .btn:hover::before {
        left: 0;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      .btn-delete {
        border-color: rgba(239, 68, 68, 0.3);
      }

      .btn-delete::before {
        background: var(--secondary-gradient);
      }

      .btn-delete:hover {
        border-color: transparent;
        color: white;
      }

      .btn-save {
        background: var(--primary-gradient);
        border-color: transparent;
        color: white;
        padding: 10px 24px;
        font-size: 0.95rem;
      }

      .btn-save:hover {
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.5);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .form-grid {
          grid-template-columns: 1fr;
        }

        .editor-footer {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }
      }

      /* Info Badge */
      .info-badge {
        background: rgba(79, 172, 254, 0.1);
        border: 1px solid rgba(79, 172, 254, 0.3);
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 0.8rem;
        color: #4facfe;
        display: flex;
        align-items: center;
        gap: 6px;
        margin-top: 6px;
      }

      /* Balance Display */
      .balance-display {
        background: var(--input-bg);
        border: 1px solid var(--input-border);
        border-radius: 10px;
        padding: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .balance-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .balance-value {
        font-size: 1.5rem;
        font-weight: 700;
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Financial Section Layout */
      .financial-section {
        display: grid;
        grid-template-columns: minmax(0, 2fr) minmax(260px, 1fr);
        gap: 20px;
        align-items: stretch;
      }

      .financial-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 18px;
        padding: 18px 22px;
        box-shadow: 0 20px 45px rgba(8, 15, 40, 0.35);
        position: relative;
        overflow: hidden;
      }

      .financial-card::after {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 18px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        pointer-events: none;
      }

      .price-card {
        display: flex;
        flex-direction: column;
        gap: 16px;
        min-height: 220px;
      }

      .price-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 16px;
      }

      .price-title {
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.3px;
      }

      .price-subtitle {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.65);
        margin-top: 4px;
      }

      .price-value {
        font-size: 1.9rem;
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-align: right;
      }

      .price-selector-row {
        display: flex;
        align-items: flex-end;
        margin-top: auto;
      }

      .balance-card {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .balance-card-title {
        font-size: 0.85rem;
        letter-spacing: 0.4px;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.7);
      }

      .balance-box {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        padding: 14px 18px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        transition: all 0.3s ease;
        width: 100%;
        min-height: 64px;
      }

      .balance-box:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-1px);
      }

      .balance-box .balance-icon {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .balance-info {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .balance-subtext {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.55);
      }

      .balance-box .balance-label {
        font-size: 0.65rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        opacity: 0.75;
        display: block;
      }

      .balance-box .balance-value {
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: -0.5px;
      }
      .balance-box.credit .balance-value {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .balance-box.unpaid .balance-value {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      @media (max-width: 900px) {
        .financial-section {
          grid-template-columns: 1fr;
        }

        .financial-card {
          padding: 16px 18px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Test Button (remove in production) -->
    <button
      onclick="openStudentEditor({
            name: 'John Doe',
            group_name: 'Group A',
            email: 'john@example.com',
            phone: '+1 (555) 123-4567',
            price_per_class: 50,
            balance: 600,
            credit: 0,
            status: 'active',
            show_in_grid: true,
            notes: 'Enrolled on November 1, 2024. Prefers evening classes.'
        })"
      style="
        position: fixed;
        top: 20px;
        left: 20px;
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 12px;
        color: white;
        font-weight: 700;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      "
    >
      üé® Open Student Editor
    </button>

    <div class="container">
      <!-- Modal Overlay (hidden by default) -->
      <div
        class="modal-overlay"
        id="studentEditorModal"
        style="display: none"
        onclick="closeEditorOnOutsideClick(event)"
      >
        <div class="student-editor" onclick="event.stopPropagation()">
          <!-- Header -->
          <div class="editor-header">
            <div class="header-identity">
              <div class="avatar-orbit">
                <div class="student-avatar-large" id="studentAvatar">JD</div>
              </div>
              <div class="identity-details">
                <div class="identity-label">Student Workspace</div>
                <div class="identity-name-row">
                  <h2 id="editorTitle">John Doe</h2>
                  <span class="meta-chip gradient" id="headerGroupChip">Group A</span>
                </div>
                <div class="identity-meta">
                  <span class="meta-chip" id="headerVisibilityChip">Calendar Visible</span>
                  <span class="meta-chip subtle">LA ‚Ä¢ PST</span>
                </div>
              </div>
            </div>
            <div class="header-actions">
              <div class="status-block">
                <div class="status-label">Status</div>
                <span
                  class="status-pill-single status-active"
                  id="statusPill"
                  onclick="cycleStatus()"
                  title="Click to cycle: Active ‚Üí Paused ‚Üí Graduated"
                >
                  ACTIVE
                </span>
                <div class="status-note">Tap to cycle</div>
              </div>
              <div class="visibility-block" onclick="toggleVisibility()" title="Show in Calendar">
                <div class="status-label">Calendar</div>
                <div class="toggle-switch active" id="visibilityToggle">
                  <div class="toggle-slider"></div>
                </div>
                <div class="visibility-hint" id="visibilityHint">Visible</div>
              </div>
              <button class="close-btn" onclick="closeEditor()">√ó</button>
            </div>
          </div>

          <!-- Body -->
          <div class="editor-body">
            <!-- Basic Information -->
            <div class="form-grid full-width">
              <div class="form-group">
                <label class="form-label">
                  <span class="icon">üë§</span>
                  Student Name
                  <span class="required">*</span>
                </label>
                <input type="text" class="form-input" id="studentName" placeholder="Enter full name" value="John Doe" />
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="icon">üë•</span>
                Group
                <span class="required">*</span>
              </label>
              <div class="group-pills" id="groupPills">
                <!-- Groups will be loaded dynamically -->
                <div class="group-pill active" onclick="selectGroup('Group A', this)" data-group="Group A">A</div>
                <div class="group-pill" onclick="selectGroup('Group B', this)" data-group="Group B">B</div>
                <div class="group-pill" onclick="selectGroup('Group C', this)" data-group="Group C">C</div>
                <div class="group-pill" onclick="selectGroup('Group D', this)" data-group="Group D">D</div>
              </div>
            </div>

            <!-- Contact Information -->
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">
                  <span class="icon">üìß</span>
                  Email
                </label>
                <input
                  type="email"
                  class="form-input"
                  id="studentEmail"
                  placeholder="student@example.com"
                  value="john@example.com"
                />
              </div>

              <div class="form-group">
                <label class="form-label">
                  <span class="icon">üì±</span>
                  Phone
                </label>
                <input
                  type="tel"
                  class="form-input"
                  id="studentPhone"
                  placeholder="+1 (555) 000-0000"
                  value="+1 (555) 123-4567"
                />
              </div>
            </div>

            <hr class="section-divider" />

            <!-- Financial Information -->
            <h3 class="section-title">üí∞ Financial Details</h3>

            <div class="financial-section">
              <div class="financial-card price-card">
                <div class="price-header">
                  <div>
                    <div class="price-title">Price per Class</div>
                    <div class="price-subtitle">Pick a quick preset or dial in a custom rate.</div>
                  </div>
                  <div class="price-value" id="priceDisplayValue">$50</div>
                </div>
                <div class="price-selector-row">
                  <div class="group-pills" id="pricePills">
                    <div class="group-pill" onclick="selectPrice(25, this)" data-price="25">25</div>
                    <div class="group-pill active" onclick="selectPrice(50, this)" data-price="50">50</div>
                    <div class="group-pill" onclick="selectPrice(75, this)" data-price="75">75</div>
                    <div class="group-pill" onclick="selectPrice(100, this)" data-price="100">100</div>
                    <div class="group-pill" onclick="selectCustomPrice(this)" data-price="custom">‚öôÔ∏è</div>
                  </div>
                </div>
                <input
                  type="number"
                  class="form-input"
                  id="pricePerClass"
                  placeholder="50"
                  value="50"
                  min="0"
                  step="1"
                  style="display: none"
                />
              </div>

              <div class="financial-card balance-card">
                <div class="balance-card-title">Balance Overview</div>
                <div class="balance-box credit">
                  <div class="balance-icon">‚ö°</div>
                  <div class="balance-info">
                    <div class="balance-label">CREDIT</div>
                    <div class="balance-subtext">Manual credits applied</div>
                  </div>
                  <div class="balance-value" id="creditValue">$0</div>
                </div>
                <div class="balance-box unpaid">
                  <div class="balance-icon">‚ùå</div>
                  <div class="balance-info">
                    <div class="balance-label">UNPAID</div>
                    <div class="balance-subtext">Auto-updated from Gmail</div>
                  </div>
                  <div class="balance-value" id="balanceValue">$600</div>
                </div>
              </div>
            </div>
            <hr class="section-divider" />

            <!-- Notes -->
            <div class="form-grid full-width">
              <div class="form-group">
                <label class="form-label">
                  <span class="icon">üìù</span>
                  Notes
                </label>
                <textarea
                  class="form-textarea"
                  id="studentNotes"
                  placeholder="Add any additional notes about the student..."
                >
Enrolled on November 1, 2024. Prefers evening classes.</textarea
                >
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div class="editor-footer">
            <button class="btn btn-delete" onclick="deleteStudent()">üóë Delete Student</button>
            <button class="btn btn-save" onclick="saveStudent()">üíæ Save Changes</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let currentStatus = 'active';
      let currentGroup = 'Group A';
      let currentPrice = 50;
      let showInCalendar = true;

      // Initialize
      function init() {
        updateAvatar();
        updatePriceDisplay(currentPrice || 50);
        updateHeaderMeta();

        // Listen to name changes for avatar
        document.getElementById('studentName').addEventListener('input', updateAvatar);
      }

      // Update Avatar
      function updateAvatar() {
        const name = document.getElementById('studentName').value.trim();
        const initials = name
          ? name
              .split(' ')
              .map(n => n[0])
              .join('')
              .toUpperCase()
              .substring(0, 2)
          : 'NA';
        document.getElementById('studentAvatar').textContent = initials;

        const titleEl = document.getElementById('editorTitle');
        if (titleEl) {
          titleEl.textContent = name || 'New Student';
        }
      }

      function updateHeaderMeta() {
        const groupChip = document.getElementById('headerGroupChip');
        if (groupChip) {
          groupChip.textContent = currentGroup;
        }

        const visibilityChip = document.getElementById('headerVisibilityChip');
        const visibilityStateText = showInCalendar ? 'Calendar Visible' : 'Hidden from Calendar';
        if (visibilityChip) {
          visibilityChip.textContent = visibilityStateText;
          visibilityChip.classList.toggle('chip-off', !showInCalendar);
        }

        const visibilityHint = document.getElementById('visibilityHint');
        if (visibilityHint) {
          visibilityHint.textContent = showInCalendar ? 'Visible' : 'Hidden';
        }
      }

      // Select Group
      function selectGroup(groupName, element) {
        currentGroup = groupName;

        // Remove active from all
        document.querySelectorAll('.group-pill').forEach(pill => {
          pill.classList.remove('active');
        });

        // Add active to selected
        element.classList.add('active');

        console.log('Group changed to:', groupName);

        updateHeaderMeta();
      }

      function updatePriceDisplay(value) {
        const priceDisplay = document.getElementById('priceDisplayValue');
        if (priceDisplay) {
          priceDisplay.textContent = `$${value}`;
        }
      }

      // Select Price
      function selectPrice(price, element) {
        currentPrice = price;
        document.getElementById('pricePerClass').value = price;
        updatePriceDisplay(price);

        const customPill = document.querySelector('.group-pill[data-price="custom"]');

        // Remove active from all price pills
        document.querySelectorAll('[data-price]').forEach(pill => {
          pill.classList.remove('active');
        });

        if (customPill && element !== customPill) {
          customPill.textContent = '‚öôÔ∏è';
        }

        // Add active to selected
        element.classList.add('active');

        console.log('Price changed to:', price);
      }

      // Select Custom Price
      function selectCustomPrice(element) {
        const customPrice = prompt('Enter custom price per class:', currentPrice || 50);

        if (customPrice !== null && customPrice.trim() !== '') {
          const price = parseFloat(customPrice);

          if (!isNaN(price) && price > 0) {
            currentPrice = price;
            document.getElementById('pricePerClass').value = price;
            updatePriceDisplay(price);

            // Remove active from all price pills
            document.querySelectorAll('[data-price]').forEach(pill => {
              pill.classList.remove('active');
            });

            // Add active to custom button
            element.classList.add('active');
            element.textContent = '$' + price;

            console.log('Custom price set to:', price);
          } else {
            alert('Please enter a valid price greater than 0');
          }
        }
      }

      // Select Status
      function selectStatus(status, element) {
        currentStatus = status;

        // Remove active from all
        document.querySelectorAll('.status-pill').forEach(pill => {
          pill.classList.remove('active');
        });

        // Add active to selected
        element.classList.add('active');

        console.log('Status changed to:', status);
      }

      // Cycle Status (like production index.html)
      function cycleStatus() {
        const statusCycle = {
          active: 'paused',
          paused: 'graduated',
          graduated: 'active',
        };

        currentStatus = statusCycle[currentStatus] || 'active';

        const statusPill = document.getElementById('statusPill');
        const statusTexts = {
          active: 'ACTIVE',
          paused: 'PAUSED',
          graduated: 'GRADUATED',
        };

        // Update pill class and text
        statusPill.className = `status-pill-single status-${currentStatus}`;
        statusPill.textContent = statusTexts[currentStatus];

        console.log('‚úÖ Status cycled to:', currentStatus);
      } // Toggle Visibility
      function toggleVisibility() {
        showInCalendar = !showInCalendar;
        const toggle = document.getElementById('visibilityToggle');

        if (showInCalendar) {
          toggle.classList.add('active');
        } else {
          toggle.classList.remove('active');
        }

        console.log('Show in calendar:', showInCalendar);

        updateHeaderMeta();
      }

      // Save Student
      function saveStudent() {
        const studentData = {
          name: document.getElementById('studentName').value,
          group_name: currentGroup,
          email: document.getElementById('studentEmail').value,
          phone: document.getElementById('studentPhone').value,
          price_per_class: currentPrice,
          status: currentStatus,
          show_in_grid: showInCalendar,
          notes: document.getElementById('studentNotes').value,
        };

        console.log('üíæ Saving student:', studentData);

        // ========================================
        // PRODUCTION INTEGRATION:
        // ========================================
        // const { data, error } = await supabase
        //     .from('students')
        //     .update(studentData)
        //     .eq('id', currentStudentId);
        //
        // if (error) {
        //     showToast('‚ùå Error saving student', '#ef4444');
        //     console.error('Supabase error:', error);
        //     return;
        // }
        //
        // // Update cache
        // window.studentsCache = window.studentsCache.map(s =>
        //     s.id === currentStudentId ? { ...s, ...studentData } : s
        // );
        // window.studentsCacheTimestamp = Date.now();
        //
        // // Dispatch event to update UI
        // window.dispatchEvent(new CustomEvent('students:updated', {
        //     detail: { source: 'student-editor', studentId: currentStudentId }
        // }));
        //
        // closeEditor();
        // ========================================

        // Demo: Show success toast
        showToast('‚úÖ Student saved successfully!', '#10b981');

        // Demo: Close after 1 second
        setTimeout(() => {
          closeEditor();
        }, 1000);
      }

      // Delete Student
      function deleteStudent() {
        const studentName = document.getElementById('studentName').value;
        const confirmed = confirm(`Are you sure you want to delete "${studentName}"? This action cannot be undone.`);

        if (confirmed) {
          console.log('üóë Deleting student...');

          // ========================================
          // PRODUCTION INTEGRATION:
          // ========================================
          // const { error } = await supabase
          //     .from('students')
          //     .delete()
          //     .eq('id', currentStudentId);
          //
          // if (error) {
          //     showToast('‚ùå Error deleting student', '#ef4444');
          //     console.error('Supabase error:', error);
          //     return;
          // }
          //
          // // Update cache
          // window.studentsCache = window.studentsCache.filter(s => s.id !== currentStudentId);
          // window.studentsCacheTimestamp = Date.now();
          //
          // // Dispatch event to update UI
          // window.dispatchEvent(new CustomEvent('students:updated', {
          //     detail: { source: 'student-editor', action: 'delete', studentId: currentStudentId }
          // }));
          //
          // closeEditor();
          // ========================================

          // Demo: Show success toast
          showToast('üóë Student deleted', '#ef4444');

          // Demo: Close after 1 second
          setTimeout(() => {
            closeEditor();
          }, 1000);
        }
      }

      // Close Editor
      function closeEditor() {
        const modal = document.getElementById('studentEditorModal');

        // Fade out animation
        modal.style.opacity = '0';

        setTimeout(() => {
          modal.style.display = 'none';
          console.log('‚úÖ Editor closed');
        }, 300);
      }

      // Close on outside click
      function closeEditorOnOutsideClick(event) {
        if (event.target.id === 'studentEditorModal') {
          closeEditor();
        }
      }

      // Open Editor (called from main app)
      function openStudentEditor(studentData = null) {
        const modal = document.getElementById('studentEditorModal');

        // If studentData provided, populate the form
        if (studentData) {
          document.getElementById('studentName').value = studentData.name || '';
          document.getElementById('studentEmail').value = studentData.email || '';
          document.getElementById('studentPhone').value = studentData.phone || '';
          document.getElementById('balanceValue').textContent = '$' + (studentData.balance || 0);
          document.getElementById('creditValue').textContent = '$' + (studentData.credit || 0);
          document.getElementById('studentNotes').value = studentData.notes || '';

          // Set price
          currentPrice = studentData.price_per_class || 50;
          document.getElementById('pricePerClass').value = currentPrice;
          updatePriceDisplay(currentPrice);
          let matchedPreset = false;
          const customPill = document.querySelector('.group-pill[data-price="custom"]');
          document.querySelectorAll('[data-price]').forEach(pill => {
            pill.classList.remove('active');
            if (pill.getAttribute('data-price') == currentPrice) {
              pill.classList.add('active');
              matchedPreset = true;
            }
          });
          if (customPill) {
            if (matchedPreset) {
              customPill.textContent = '‚öôÔ∏è';
            } else {
              customPill.classList.add('active');
              customPill.textContent = '$' + currentPrice;
            }
          }

          // Set group
          currentGroup = studentData.group_name || 'Group A';
          document.querySelectorAll('.group-pill').forEach(pill => {
            pill.classList.remove('active');
            if (pill.getAttribute('data-group') === currentGroup) {
              pill.classList.add('active');
            }
          });

          // Set status
          currentStatus = studentData.status || 'active';
          const statusPill = document.getElementById('statusPill');
          const statusTexts = {
            active: 'ACTIVE',
            paused: 'PAUSED',
            graduated: 'GRADUATED',
          };
          statusPill.className = `status-pill-single status-${currentStatus}`;
          statusPill.textContent = statusTexts[currentStatus];

          // Set visibility toggle
          showInCalendar = studentData.show_in_grid !== false;
          const toggle = document.getElementById('visibilityToggle');
          if (showInCalendar) {
            toggle.classList.add('active');
          } else {
            toggle.classList.remove('active');
          }
        }

        updateAvatar();
        updateHeaderMeta();

        // Fade in animation
        modal.style.opacity = '0';
        modal.style.display = 'flex';

        requestAnimationFrame(() => {
          modal.style.opacity = '1';
        });

        console.log('‚úÖ Editor opened');
      }

      // Toast Notification
      function showToast(message, color) {
        const toast = document.createElement('div');
        toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color};
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                font-weight: 600;
                font-size: 0.9rem;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
                z-index: 100000;
                animation: slideIn 0.3s ease-out;
            `;
        toast.textContent = message;

        const style = document.createElement('style');
        style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(400px); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(400px); opacity: 0; }
                }
            `;
        document.head.appendChild(style);

        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.animation = 'slideOut 0.3s ease-out';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // Initialize on load
      document.addEventListener('DOMContentLoaded', init);
    </script>
  </body>
</html>
